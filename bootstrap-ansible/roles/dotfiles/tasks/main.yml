---
- name: Ensure stow is installed
  package:
    name: stow
    state: present
  become: true

- name: Clone dotfiles repo into ~/my-dotrepo
  git:
    repo: "https://github.com/aju773/my-dotrepo.git"
    dest: "/home/{{ user_name }}/my-dotrepo"
    version: main
    update: yes
  become: false

- name: Ensure ~/.config exists as a directory
  file:
    path: "{{ home_dir }}/.config"
    state: directory
    owner: "{{ user_name }}"
    group: "{{ user_name }}"
    mode: '0755'
  become: false

# OPTIONAL: clean up bad symlinks that stow previously dumped into ~/
- name: Remove stray symlinks from $HOME (from old stow runs)
  file:
    path: "{{ home_dir }}/{{ item }}"
    state: absent
  loop:
    - alacritty
    - ghostty
    - kitty
    - nvim
    - tmux
    - starship.toml
  become: false

- name: Stow repo .config contents into ~/.config
  command: >
    stow --verbose --adopt
         --dir="/home/{{ user_name }}/my-dotrepo"
         --target="{{ home_dir }}/.config"
         .config
  args:
    chdir: "/home/{{ user_name }}/my-dotrepo"
  become: false
  register: stow_result

- name: Show stow output for debugging
  debug:
    var: stow_result

