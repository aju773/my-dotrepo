---
- name: Ensure dotfiles directory exists
  file:
    path: "{{ dotfiles_dir }}"
    state: directory
  become: false

- name: Install GNU Stow if not present
  package:
    name: stow
    state: present
  become: true

- name: Symlink dotfiles with stow
  command: >
    stow -v --target="{{ dotfiles_dir }}" --adopt {{ item }}
  args:
    chdir: "{{ dotfiles_repo_path }}/.config"
  loop:
    - alacritty
    - ghostty
    - kitty
    - nvim
    - tmux
  become: false

- name: Ensure starship is initialized in bashrc
  lineinfile:
    path: "{{ ansible_env.HOME }}/.bashrc"
    line: 'eval "$(starship init bash)"'
    state: present
  become: false
